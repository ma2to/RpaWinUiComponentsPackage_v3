<UserControl
    x:Class="RpaWinUiComponentsPackage.AdvancedWinUiDataGrid.AdvancedDataGrid"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:RpaWinUiComponentsPackage.AdvancedWinUiDataGrid">
    
    <UserControl.Resources>
        <local:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
    </UserControl.Resources>
    
    <Grid x:Name="RootGrid" Background="White">
        <!-- ScrollViewer for large tables -->
        <ScrollViewer x:Name="MainScrollViewer" 
                      ZoomMode="Disabled" 
                      HorizontalScrollMode="Auto" 
                      VerticalScrollMode="Auto" 
                      HorizontalScrollBarVisibility="Auto" 
                      VerticalScrollBarVisibility="Auto">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/> <!-- Headers -->
                    <RowDefinition Height="Auto"/> <!-- Data rows -->
                </Grid.RowDefinitions>
            
            <!-- HEADERS -->
            <ItemsRepeater x:Name="HeadersRepeater"
                           Grid.Row="0">
                <ItemsRepeater.Layout>
                    <StackLayout Orientation="Horizontal"/>
                </ItemsRepeater.Layout>
                <ItemsRepeater.ItemTemplate>
                    <DataTemplate>
                        <Border Background="#E0E0E0" BorderBrush="#808080" BorderThickness="1,1,1,1" Height="32" Width="{Binding Width}">
                            <Grid>
                                <TextBlock Text="{Binding DisplayName}" 
                                           FontWeight="SemiBold" 
                                           HorizontalAlignment="Center" 
                                           VerticalAlignment="Center"
                                           Foreground="Black"/>
                                <!-- Resize grip area -->
                                <Border Width="6" 
                                        Height="32" 
                                        Background="Transparent" 
                                        HorizontalAlignment="Right"
                                        Tag="{Binding}"
                                        PointerPressed="ResizeGrip_PointerPressed"
                                        PointerMoved="ResizeGrip_PointerMoved"
                                        PointerReleased="ResizeGrip_PointerReleased"
                                        PointerCaptureLost="ResizeGrip_PointerCaptureLost"/>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsRepeater.ItemTemplate>
            </ItemsRepeater>
            
            <!-- DATA ROWS -->
            <ItemsRepeater x:Name="DataRowsRepeater"
                           Grid.Row="1">
                <ItemsRepeater.ItemTemplate>
                    <DataTemplate>
                        <ItemsRepeater ItemsSource="{Binding Cells}">
                            <ItemsRepeater.Layout>
                                <StackLayout Orientation="Horizontal"/>
                            </ItemsRepeater.Layout>
                            <ItemsRepeater.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="{Binding CellBackgroundBrush, FallbackValue=White}" 
                                            BorderBrush="{Binding BorderBrush, FallbackValue=#808080}" 
                                            BorderThickness="1,1,1,1" 
                                            Height="28" 
                                            Width="{Binding ColumnWidth}"
                                            Tag="{Binding}"
                                            Tapped="CellBorder_Tapped"
                                            DoubleTapped="CellBorder_DoubleTapped">
                                        <Grid>
                                            <!-- Regular cell content -->
                                            <TextBlock Text="{Binding Value}" 
                                                       VerticalAlignment="Center" 
                                                       HorizontalAlignment="Left"
                                                       Margin="4,0,0,0"
                                                       Foreground="Black"/>
                                            
                                            <!-- Delete button for delete column (always visible, but only functional in delete cells) -->
                                            <Button Content="🗑️" 
                                                    FontSize="14" 
                                                    Background="Transparent" 
                                                    BorderBrush="Transparent"
                                                    HorizontalAlignment="Center" 
                                                    VerticalAlignment="Center"
                                                    Padding="2"
                                                    MinWidth="20"
                                                    MinHeight="20"
                                                    Tag="{Binding}"
                                                    Visibility="{Binding IsDeleteCell, Converter={StaticResource BoolToVisibilityConverter}}"
                                                    Click="DeleteButton_Click"/>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsRepeater.ItemTemplate>
                        </ItemsRepeater>
                    </DataTemplate>
                </ItemsRepeater.ItemTemplate>
            </ItemsRepeater>
            </Grid>
        </ScrollViewer>
        
        <!-- Fallback text - hidden when data is available -->
        <TextBlock x:Name="FallbackText" Text="DataGrid Ready" HorizontalAlignment="Center" VerticalAlignment="Center" 
                   Foreground="Gray" FontSize="12" Visibility="Visible"/>
    </Grid>
        
</UserControl>