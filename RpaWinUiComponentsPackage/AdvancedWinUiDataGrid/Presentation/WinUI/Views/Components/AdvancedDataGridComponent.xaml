<UserControl x:Class="RpaWinUiComponentsPackage.AdvancedWinUiDataGrid.Internal.UI.Components.AdvancedDataGridComponent"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="using:RpaWinUiComponentsPackage.AdvancedWinUiDataGrid.Internal.UI.Components"
             xmlns:converters="using:RpaWinUiComponentsPackage.AdvancedWinUiDataGrid.Internal.UI.Converters"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d">

    <UserControl.Resources>
        <!-- UI: Converters -->
        <converters:ValidationBorderConverter x:Key="ValidationBorderConverter"/>

        <!-- UI: Styles and Templates -->
        <Style x:Key="DataViewStyle" TargetType="ListView">
            <Setter Property="SelectionMode" Value="Extended"/>
            <Setter Property="IsItemClickEnabled" Value="True"/>
            <Setter Property="Background" Value="{ThemeResource SystemControlBackgroundChromeMediumLowBrush}"/>
            <Setter Property="BorderBrush" Value="{ThemeResource SystemControlForegroundBaseMediumLowBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>
        
        <Style x:Key="StatusBarStyle" TargetType="Border">
            <Setter Property="Background" Value="{ThemeResource SystemControlBackgroundChromeMediumBrush}"/>
            <Setter Property="BorderBrush" Value="{ThemeResource SystemControlForegroundBaseMediumLowBrush}"/>
            <Setter Property="BorderThickness" Value="0,1,0,0"/>
            <Setter Property="Height" Value="24"/>
        </Style>
        
        <Style x:Key="ValidationErrorStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="Red"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Margin" Value="4,2"/>
        </Style>
        
        <Style x:Key="ToolbarButtonStyle" TargetType="Button">
            <Setter Property="Margin" Value="4,0"/>
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="MinWidth" Value="80"/>
        </Style>
        
        <!-- AUTO ROW HEIGHT: Styles for text wrapping and dynamic row heights -->
        <Style x:Key="AutoHeightTextBlockStyle" TargetType="TextBlock">
            <Setter Property="TextWrapping" Value="Wrap"/>
            <Setter Property="TextTrimming" Value="None"/>
            <Setter Property="LineStackingStrategy" Value="BlockLineHeight"/>
            <Setter Property="MaxLines" Value="0"/>
            <Setter Property="VerticalAlignment" Value="Top"/>
            <Setter Property="Padding" Value="4,2"/>
        </Style>
        
        <Style x:Key="AutoHeightCellStyle" TargetType="Border">
            <Setter Property="MinHeight" Value="24"/>
            <Setter Property="MaxHeight" Value="200"/>
            <Setter Property="VerticalAlignment" Value="Stretch"/>
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
            <Setter Property="Padding" Value="0"/>
        </Style>
        
        <Style x:Key="AutoHeightRowStyle" TargetType="ListViewItem">
            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
            <Setter Property="VerticalContentAlignment" Value="Top"/>
            <Setter Property="MinHeight" Value="24"/>
            <Setter Property="MaxHeight" Value="200"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="Margin" Value="0"/>
        </Style>
    </UserControl.Resources>

    <Grid x:Name="MainGrid">
        <Grid.RowDefinitions>
            <!-- Toolbar -->
            <RowDefinition Height="Auto"/>
            <!-- Main DataGrid Area -->
            <RowDefinition Height="*"/>
            <!-- Status Bar -->
            <RowDefinition Height="Auto"/>
            <!-- Validation Panel -->
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- UI: Toolbar -->
        <Border Grid.Row="0" x:Name="ToolbarBorder" 
                Background="{ThemeResource SystemControlBackgroundChromeMediumLowBrush}"
                BorderBrush="{ThemeResource SystemControlForegroundBaseMediumLowBrush}"
                BorderThickness="0,0,0,1"
                Height="40">
            <StackPanel Orientation="Horizontal" Margin="8,0">
                <Button x:Name="AddRowButton" Content="Add Row" Style="{StaticResource ToolbarButtonStyle}"/>
                <Button x:Name="DeleteRowButton" Content="Delete Row" Style="{StaticResource ToolbarButtonStyle}"/>
                <Border Width="1" Background="{ThemeResource SystemControlForegroundBaseMediumLowBrush}" Margin="4,0"/>
                <Button x:Name="ValidateButton" Content="Validate" Style="{StaticResource ToolbarButtonStyle}"/>
                <Button x:Name="ClearFiltersButton" Content="Clear Filters" Style="{StaticResource ToolbarButtonStyle}"/>
                <Border Width="1" Background="{ThemeResource SystemControlForegroundBaseMediumLowBrush}" Margin="4,0"/>
                <TextBox x:Name="SearchTextBox" PlaceholderText="Search..." Width="200" Margin="4,0"/>
                <Button x:Name="SearchButton" Content="Search" Style="{StaticResource ToolbarButtonStyle}"/>
            </StackPanel>
        </Border>
        
        <!-- UI: Main Data Display -->
        <ScrollViewer Grid.Row="1" x:Name="DataGridScrollViewer"
                      ZoomMode="Disabled"
                      HorizontalScrollBarVisibility="Auto"
                      VerticalScrollBarVisibility="Auto">
            <StackPanel>
                <!-- DataGrid Header -->
                <Border BorderThickness="1,1,1,1"
                        BorderBrush="{ThemeResource SystemControlForegroundBaseMediumLowBrush}"
                        Background="{ThemeResource SystemControlBackgroundChromeMediumBrush}"
                        MinHeight="32">
                    <Grid Margin="4,2">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="80"/>
                            <ColumnDefinition Width="150"/>
                            <ColumnDefinition Width="200"/>
                            <ColumnDefinition Width="120"/>
                            <ColumnDefinition Width="250"/>
                        </Grid.ColumnDefinitions>

                        <Border Grid.Column="0"
                                BorderThickness="0,0,1,0"
                                BorderBrush="{ThemeResource SystemControlForegroundBaseMediumLowBrush}"
                                Padding="8,4">
                            <TextBlock Text="ID" FontWeight="Bold" VerticalAlignment="Center"/>
                        </Border>
                        <Border Grid.Column="1"
                                BorderThickness="0,0,1,0"
                                BorderBrush="{ThemeResource SystemControlForegroundBaseMediumLowBrush}"
                                Padding="8,4">
                            <TextBlock Text="Name" FontWeight="Bold" VerticalAlignment="Center"/>
                        </Border>
                        <Border Grid.Column="2"
                                BorderThickness="0,0,1,0"
                                BorderBrush="{ThemeResource SystemControlForegroundBaseMediumLowBrush}"
                                Padding="8,4">
                            <TextBlock Text="Email" FontWeight="Bold" VerticalAlignment="Center"/>
                        </Border>
                        <Border Grid.Column="3"
                                BorderThickness="0,0,1,0"
                                BorderBrush="{ThemeResource SystemControlForegroundBaseMediumLowBrush}"
                                Padding="8,4">
                            <TextBlock Text="Status" FontWeight="Bold" VerticalAlignment="Center"/>
                        </Border>
                        <Border Grid.Column="4"
                                BorderThickness="0,0,0,0"
                                Padding="8,4">
                            <TextBlock Text="ValidationAlerts" FontWeight="Bold" VerticalAlignment="Center"/>
                        </Border>
                    </Grid>
                </Border>

                <!-- Custom DataGrid using ItemsControl for better cell control -->
                <ItemsControl x:Name="MainDataView" Margin="0">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border BorderThickness="1,0,1,1"
                                    BorderBrush="{ThemeResource SystemControlForegroundBaseMediumLowBrush}"
                                    MinHeight="32">
                                <Grid Margin="4,2">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="80"/>
                                        <ColumnDefinition Width="150"/>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="250"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- ID Cell -->
                                    <Border Grid.Column="0"
                                            BorderThickness="0,0,1,0"
                                            BorderBrush="{ThemeResource SystemControlForegroundBaseMediumLowBrush}"
                                            Padding="8,4"
                                            Background="Transparent">
                                        <TextBox x:Name="IDTextBox"
                                                 Text="{Binding ID, Mode=TwoWay}"
                                                 BorderThickness="0"
                                                 Background="Transparent"
                                                 VerticalAlignment="Center"
                                                 IsReadOnly="True"
                                                 DoubleTapped="Cell_DoubleTapped"
                                                 LostFocus="Cell_LostFocus"
                                                 KeyDown="Cell_KeyDown"/>
                                    </Border>

                                    <!-- Name Cell -->
                                    <Border Grid.Column="1"
                                            BorderThickness="0,0,1,0"
                                            BorderBrush="{ThemeResource SystemControlForegroundBaseMediumLowBrush}"
                                            Padding="8,4"
                                            Background="Transparent">
                                        <TextBox x:Name="NameTextBox"
                                                 Text="{Binding Name, Mode=TwoWay}"
                                                 BorderThickness="0"
                                                 Background="Transparent"
                                                 VerticalAlignment="Center"
                                                 IsReadOnly="True"
                                                 DoubleTapped="Cell_DoubleTapped"
                                                 LostFocus="Cell_LostFocus"
                                                 KeyDown="Cell_KeyDown"/>
                                    </Border>

                                    <!-- Email Cell -->
                                    <Border Grid.Column="2"
                                            BorderThickness="0,0,1,0"
                                            BorderBrush="{ThemeResource SystemControlForegroundBaseMediumLowBrush}"
                                            Padding="8,4"
                                            Background="Transparent">
                                        <TextBox x:Name="EmailTextBox"
                                                 Text="{Binding Email, Mode=TwoWay}"
                                                 BorderThickness="0"
                                                 Background="Transparent"
                                                 VerticalAlignment="Center"
                                                 IsReadOnly="True"
                                                 DoubleTapped="Cell_DoubleTapped"
                                                 LostFocus="Cell_LostFocus"
                                                 KeyDown="Cell_KeyDown"/>
                                    </Border>

                                    <!-- Status Cell -->
                                    <Border Grid.Column="3"
                                            BorderThickness="0,0,1,0"
                                            BorderBrush="{ThemeResource SystemControlForegroundBaseMediumLowBrush}"
                                            Padding="8,4"
                                            Background="Transparent">
                                        <TextBox x:Name="StatusTextBox"
                                                 Text="{Binding Status, Mode=TwoWay}"
                                                 BorderThickness="0"
                                                 Background="Transparent"
                                                 VerticalAlignment="Center"
                                                 IsReadOnly="True"
                                                 DoubleTapped="Cell_DoubleTapped"
                                                 LostFocus="Cell_LostFocus"
                                                 KeyDown="Cell_KeyDown"/>
                                    </Border>

                                    <!-- ValidationAlerts Cell -->
                                    <Border Grid.Column="4"
                                            BorderThickness="1,0,0,0"
                                            BorderBrush="{Binding ValidationAlerts, Converter={StaticResource ValidationBorderConverter}, ConverterParameter=border}"
                                            Padding="8,4"
                                            Background="Transparent">
                                        <TextBlock Text="{Binding ValidationAlerts}"
                                                   VerticalAlignment="Center"
                                                   TextWrapping="Wrap"
                                                   FontSize="12"
                                                   IsTextSelectionEnabled="True"
                                                   Foreground="{Binding ValidationAlerts, Converter={StaticResource ValidationBorderConverter}, ConverterParameter=text}"/>
                                    </Border>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <StackPanel Orientation="Vertical"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                </ItemsControl>
            </StackPanel>
        </ScrollViewer>
        
        <!-- UI: Status Bar -->
        <Border Grid.Row="2" x:Name="StatusBar" Style="{StaticResource StatusBarStyle}">
            <StackPanel Orientation="Horizontal" Margin="8,2">
                <TextBlock x:Name="RowCountText" Text="Rows: 0" Margin="0,0,16,0"/>
                <TextBlock x:Name="FilteredRowCountText" Text="Filtered: 0" Margin="0,0,16,0"/>
                <TextBlock x:Name="ValidationStatusText" Text="Valid" Margin="0,0,16,0"/>
                <TextBlock x:Name="OperationStatusText" Text="Ready" Margin="0,0,16,0"/>
            </StackPanel>
        </Border>
        
        <!-- UI: Validation Panel -->
        <Border Grid.Row="3" x:Name="ValidationPanel" 
                Background="{ThemeResource SystemControlBackgroundChromeMediumLowBrush}"
                BorderBrush="{ThemeResource SystemControlForegroundBaseMediumLowBrush}"
                BorderThickness="0,1,0,0"
                Visibility="Collapsed"
                MaxHeight="150">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel x:Name="ValidationErrorsPanel" Margin="8">
                    <TextBlock Text="Validation Errors:" FontWeight="Bold" Margin="0,0,0,4"/>
                    <ItemsControl x:Name="ValidationErrorsList">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding}" Style="{StaticResource ValidationErrorStyle}"/>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </ScrollViewer>
        </Border>
        
        <!-- UI: Loading Overlay -->
        <Border x:Name="LoadingOverlay" Grid.RowSpan="4"
                Background="{ThemeResource SystemControlBackgroundChromeMediumBrush}"
                Opacity="0.8"
                Visibility="Collapsed">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <ProgressRing IsActive="True" Width="48" Height="48" Margin="0,0,0,16"/>
                <TextBlock x:Name="LoadingText" Text="Loading..." HorizontalAlignment="Center"/>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>